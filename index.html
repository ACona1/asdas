<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fsh5Flix — المكتبة</title>
  <style>
    :root{--bg:#02141a;--accent:#e50914;--text:#eaf6ff}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#00121a,#02141a);color:var(--text);font-family:Inter,system-ui,Arial}
    header{padding:18px 28px;display:flex;justify-content:space-between;align-items:center}
    .brand{font-weight:900;color:var(--accent)}
    main{padding:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px}
    .card{border-radius:12px;overflow:hidden;cursor:pointer;transition:transform .22s,box-shadow .22s;background:rgba(255,255,255,0.02)}
    .card:hover{transform:translateY(-8px) scale(1.03);box-shadow:0 20px 60px rgba(0,0,0,0.5)}
    .thumb{height:300px;background:#071826;display:flex;align-items:end;position:relative}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .title{padding:10px 12px;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    footer{padding:18px;text-align:center;color:rgba(255,255,255,0.35)}
    @media (max-width:900px){.thumb{height:200px}}
  </style>
</head>
<body>
  <header>
    <div class="brand">Fsh5Flix</div>
    <div style="color:rgba(255,255,255,0.6)">PixelDrain</div>
  </header>

  <main>
    <h2 style="margin:0 0 14px 0;padding-left:12px">المكتبة</h2>
    <div class="grid" id="catalog"></div>
  </main>

  <footer>اضغط على أي بوستر لفتح المشغل</footer>

  <script>
    // expects catalog.json to be simple array of folder names, e.g.:
    // [ "Dexter S01", "The Reavent" ]
    const CATALOG_URL = '/catalog.json';
    const catalogEl = document.getElementById('catalog');

    function makeCard(folderName){
      const enc = encodeURIComponent(folderName);
      const posterPath = `${enc}/poster.jpg`; // poster inside folder (encoded)

      const card = document.createElement('div'); card.className = 'card';
      const thumb = document.createElement('div'); thumb.className = 'thumb';
      const img = document.createElement('img');
      img.alt = folderName;
      img.src = posterPath; // browser will request encoded path
      img.onerror = () => { img.src = 'poster_default.jpg'; };
      thumb.appendChild(img);

      const title = document.createElement('div'); title.className = 'title'; title.textContent = folderName;
      card.appendChild(thumb); card.appendChild(title);

      card.addEventListener('click', ()=>{
        const url = new URL(window.location.origin + '/player.html');
        url.searchParams.set('folder', folderName);
        url.searchParams.set('idx', '0');
        window.location.href = url.toString();
      });

      return card;
    }

    async function loadCatalog(){
      try{
        const res = await fetch(CATALOG_URL);
        if(!res.ok) throw new Error('فشل تحميل catalog.json');
        const data = await res.json();
        if(!Array.isArray(data)) throw new Error('catalog.json لازم يبقى مصفوفة (Array) من أسماء الفولدرات');

        catalogEl.innerHTML = '';
        data.forEach(folderName => {
          if(typeof folderName === 'string') catalogEl.appendChild(makeCard(folderName));
        });
      }catch(err){
        catalogEl.innerHTML = `<div style="padding:20px;color:#f88">خطأ: ${err.message}</div>`;
        console.error(err);
      }
    }

    loadCatalog();
  </script>
</body>
</html>
